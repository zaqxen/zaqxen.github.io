<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ajman Bus Schedule</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #f8f9fa; }
    .highlight { background: #ffc107 !important; color: #000; font-weight: bold; padding: 2px 4px; border-radius: 4px; }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem;
      margin-bottom: 2rem;
    }
    .next-bus-card {
      border-radius: 6px;
      padding: 0.75rem;
      text-align: center;
      color: #fff;
      font-size: 0.9rem;
    }
    .next-bus-card h6 { margin-bottom: 0.25rem; font-size: 1rem; }
    .status-red { background: #dc3545; }
    .status-orange { background: #fd7e14; }
    .status-yellow { background: #ffc107; color: #000; }
    .status-green { background: #28a745; }
    .status-blue { background: #007bff; }
    .collapse td { background: #fdfdfd; }
    .table td, .table th { vertical-align: middle; }
	
	/* === Dashboard as compact stacked stripes === */
.dashboard {
  display: block;     /* no grid on mobile */
  margin: 0;
  padding: 0;
  gap: 0;             /* kill gap */
}

.next-bus-card {
  border-radius: 0;   /* no rounded edges */
  padding: 2px 6px;   /* thin padding */
  margin: 0;          /* no margins */
  text-align: left;
  font-size: 0.8rem;
  line-height: 1.2;
}

.next-bus-card h6 {
  margin: 0;
  font-size: 0.85rem;
}

.next-bus-card p {
  margin: 0;          /* kill default p margin */
  padding: 0;
}
 li.list-group-item nobr{
 font-size:0.9em;
}
/* Keep desktop grid view */
@media (min-width: 769px) {
  .dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
    margin-bottom: 2rem;
  }
  .next-bus-card {
    border-radius: 6px;
    padding: 0.75rem;
    text-align: center;
    font-size: 0.9rem;
  }
  .next-bus-card h6 {
    margin-bottom: 0.25rem;
    font-size: 1rem;
  }
 }
  </style>
</head>
<body>

<div class="container my-4">
  <h2 class="text-center mb-4">ðŸšŒ Ajman Bus Schedule</h2>

  <!-- Per-Line Dashboard -->
  <div id="dashboard" class="dashboard mb-3"></div>

  <!-- Bus Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-dark">
        <tr>
          <th>Bus Line</th>
          <th>Destination</th>
          <th>Cash Fare</th>
          <th>Masar Card</th>
          <th class="d-none d-md-table-cell">Schedule</th>
        </tr>
      </thead>
      <tbody id="bus-table-body"></tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // === DATA ===
  const routes = [
    { line: "Al Ain (AUD)", destination: "Al Ain", fareCash: "35 AED", fareMasar: "35 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["08:00","12:00","16:00","20:00"] }] },
    { line: "Abu Dhabi (AUD)", destination: "Abu Dhabi", fareCash: "35 AED", fareMasar: "35 AED",
      schedules: [
        { title: "From Al Musalla Station", link: "#", times: ["07:00","11:00","15:00","19:00"] },
        { title: "From Abu Dhabi Main Bus Station", link: "#", times: ["07:00","11:00","15:00","19:00"] }
      ] },
    { line: "Ras Al Khaimah", destination: "Ras Al Khaimah", fareCash: "25 AED", fareMasar: "N/A",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["07:30","09:30","11:30","13:30","15:30","17:30","19:30","21:30"] }] },
    { line: "Al Jurf (AJ1)", destination: "Al Jurf", fareCash: "5 AED", fareMasar: "5 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["06:00","06:30","07:00","07:15","07:30","07:45","08:15","08:45","09:00","09:15","09:30","09:45","10:15","10:45","11:00","11:15","11:30","12:00","12:15","12:30","12:45","13:00","13:30","13:45","14:15","14:45","15:15","15:30","16:00","16:15","16:45","17:00","17:15","17:45","18:00","18:15","18:30","18:45","19:15","19:30","19:45","20:00","20:30","20:45","21:00","21:30","21:45","22:10","22:50","23:20"] }] },
    { line: "Industrial (AJ2)", destination: "Industrial Area", fareCash: "5 AED", fareMasar: "5 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["06:00","06:20","06:40","07:00","07:20","07:40","08:00","08:20","08:40","09:00","09:20","09:40","10:00","10:25","10:50","11:15","11:40","12:10","12:30","12:50","13:10","13:30","13:50","14:15","14:40","15:00","15:20","15:40","16:00","16:20","16:40","17:00","17:25","17:50","18:10","18:40","19:05","19:25","19:50","20:10","20:30","20:50","21:15","21:35","21:55","22:15","22:40","23:05"] }] },
    { line: "Hamidiya (AJ3)", destination: "Al Hamidiya", fareCash: "5 AED", fareMasar: "5 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["06:00","06:20","06:40","07:00","07:15","07:30","07:50","08:10","08:30","09:00","09:20","09:40","10:00","10:30","10:50","11:10","11:30","12:00","12:20","12:40","13:00","13:30","14:30","15:30","16:00","16:30","16:50","17:10","17:30","18:00","18:20","18:40","19:00","19:30","19:50","20:10","20:30","21:00","21:20","21:40","22:00","22:30","22:50","23:10"] }] },
	{ line: "Sheikh Ammar St. (AJ6)", destination: "Sheikh Ammar St.", fareCash: "5 AED", fareMasar: "5 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["06:00","06:25","06:50","07:15","07:45","08:10","08:35","09:00","09:30","09:55","10:20","10:45","11:15","11:40","12:05","12:30","13:00","13:25","13:50","14:15","14:45","15:10","15:35","16:00","16:30","16:55","17:20","17:45","18:15","18:40","19:05","19:30","20:00","20:25","20:50","21:15","21:45","22:10","22:35","23:00"] }] },
	{ line: "Mushairef (AJ7)", destination: "Al Mushairef", fareCash: "5 AED", fareMasar: "5 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00"] }] },
    { line: "Sharjah (SHJ1)", destination: "Sharjah", fareCash: "9 AED", fareMasar: "9 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["06:00","06:20","06:40","07:00","07:20","07:40","08:00","08:20","08:40","09:00","09:20","09:40","10:00","10:20","10:40","11:00","11:20","11:40","12:00","12:20","12:40","13:00","13:20","13:40","14:00","14:20","14:40","15:00","15:20","15:40","16:00","16:20","16:40","17:00","17:20","17:40","18:00","18:20","18:40","19:00","19:20","19:40","20:00","20:20","20:40","21:00","21:20","21:40","22:00","22:20","22:40","23:00"] }] },
    { line: "Centrepoint (DXB1)", destination: "Rashidiya Metro", fareCash: "15 AED", fareMasar: "15 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["05:45","06:15","06:45","07:15","07:45","08:15","08:45","09:15","09:45","10:15","10:45","11:15","11:45","12:15","12:45","13:15","13:45","14:15","14:45","15:15","15:45","16:15","16:45","17:15","17:45","18:15","18:45","19:15","19:45","20:15","20:45","21:15","21:45","22:15","22:45"] }] },
    { line: "Umm Al Quwain (UAQ)", destination: "Umm Al Quwain", fareCash: "15 AED", fareMasar: "15 AED",
      schedules: [{ title: "From Al Musalla Station", link: "#", times: ["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00"] }] },
    { line: "Hamidiya Feeder", destination: "ADNOC Al Muntazi", fareCash: "3 AED", fareMasar: "3 AED",
      schedules: [{ title: "From ADNOC Al Muntazi", link: "#", times: ["06:00","06:45","07:30","08:15","09:00","09:45","10:30","11:15","12:00","12:45","13:30","14:15","15:45","16:30","17:15","18:00","18:45","19:30","20:15","21:00","21:45","22:30","23:15","23:50"] }] },
    // âœ… MERGED Global Village
    { line: "Global Village", destination: "Global Village", fareCash: "25 AED", fareMasar: "25 AED",
      schedules: [
        { title: "Weekday - From Al Musalla Station", link: "#", times: ["14:15","16:45","18:15"] },
        { title: "Weekday - From Global Village", link: "#", times: ["15:45","22:30","00:30"] },
        { title: "Weekend - From Al Musalla Station", link: "#", times: ["14:15","16:45","18:45"] },
        { title: "Weekend - From Global Village", link: "#", times: ["15:45","22:30","01:30"] }
      ] }
  ];

  // === UTILS ===
  function parseTimeToDate(timeStr) {
    const [h, m] = timeStr.split(":").map(Number);
    const d = new Date();
    d.setHours(h, m, 0, 0);
    return d;
  }

  function minutesDiff(a, b) {
    return Math.round((a - b) / 60000);
  }

  function statusClass(diff) {
    if (diff <= 15) return "status-red";
    if (diff <= 30) return "status-orange";
    if (diff <= 40) return "status-yellow";
    if (diff > 40) return "status-green";
    return "status-blue";
  }

  function isWeekend() {
    const day = new Date().getDay(); // 0=Sun, 5=Fri, 6=Sat
    return day === 5 || day === 6;
  }

  // === RENDER TABLE ===
	const tbody = document.getElementById("bus-table-body");
	routes.forEach((route, i) => {
	  const id = "collapse-" + i;
	  tbody.insertAdjacentHTML("beforeend", `
		<tr class="clickable-row" data-bs-target="#${id}">
		  <td>${route.line}</td>
		  <td>${route.destination}</td>
		  <td>${route.fareCash}</td>
		  <td>${route.fareMasar}</td>
		  <td class="d-none d-md-table-cell">
			<button class="btn btn-sm btn-primary" data-bs-toggle="collapse" data-bs-target="#${id}">
			  View Times
			</button>
		  </td>
		</tr>
		<tr class="collapse" id="${id}">
		  <td colspan="5">
			${route.schedules.map(s => `
			  <strong>${s.title}:</strong> <a href="${s.link}" target="_blank">Click here</a><br>
			  <span class="times" data-line="${route.line}">${s.times.join(", ")}</span><br><br>
			`).join("")}
		  </td>
		</tr>
	  `);
	});



  // === RENDER DASHBOARD ===
  const dashboard = document.getElementById("dashboard");

	// Desktop = card grid
	const desktopContainer = document.createElement("div");
	desktopContainer.className = "dashboard d-none d-md-grid";

	routes.forEach(route => {
	  desktopContainer.insertAdjacentHTML("beforeend", `
		<div class="next-bus-card" id="card-${route.line.replace(/\W+/g,"-")}">
		  <h6>${route.line}</h6>
		  <p class="next-time">Loading...</p>
		</div>
	  `);
	});

	// Mobile = list group
	const mobileList = document.createElement("ul");
	mobileList.className = "list-group d-md-none";

	routes.forEach(route => {
	  mobileList.insertAdjacentHTML("beforeend", `
		<li class="list-group-item" id="list-${route.line.replace(/\W+/g,"-")}" style="text-align:center">
		  <strong>${route.line}</strong> -
		  <nobr class="next-time">Loading...</nobr>
		</li>
	  `);
	});

	dashboard.appendChild(desktopContainer);
	dashboard.appendChild(mobileList);


  // === FIND NEXT BUS PER LINE ===
  function findNextPerLine() {
  const now = new Date();
  routes.forEach(route => {
    let closest = null;

    const validSchedules = route.line.includes("Global Village")
      ? route.schedules.filter(s => isWeekend() ? s.title.includes("Weekend") : s.title.includes("Weekday"))
      : route.schedules;

    validSchedules.forEach(s => {
      s.times.forEach(time => {
        const d = parseTimeToDate(time);
        if (d > now && (!closest || d < closest)) closest = d;
      });
    });

    const card = document.querySelector(`#card-${route.line.replace(/\W+/g,"-")}`);
    const listItem = document.querySelector(`#list-${route.line.replace(/\W+/g,"-")}`);

    let label = "No more buses today";
    let cssClass = "status-blue";

    if (closest) {
      const diff = minutesDiff(closest, now);
      cssClass = statusClass(diff);
      label = `Next at ${closest.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})} (${diff} min)`;
    }

    if (card) {
      card.className = `next-bus-card ${cssClass}`;
      card.querySelector(".next-time").textContent = label;
    }

    if (listItem) {
      listItem.className = `list-group-item p-1 ${cssClass}`;
      listItem.querySelector(".next-time").textContent = label;
    }
  });
}


  function highlightUpcoming() {
    const now = new Date();
    document.querySelectorAll(".times").forEach(el => {
      const times = el.innerText.split(",").map(t => t.trim());
      let highlighted = false;
      el.innerHTML = times.map(time => {
        const d = parseTimeToDate(time);
        if (!highlighted && d > now) {
          highlighted = true;
          return `<span class="highlight">${time}</span>`;
        }
        return time;
      }).join(", ");
    });
  }

  // Init
  findNextPerLine();
  highlightUpcoming();
  setInterval(() => {
    findNextPerLine();
    highlightUpcoming();
  }, 10000);
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Enable tap/click on rows to show timings
    document.querySelectorAll("tr.clickable-row").forEach(row => {
      row.addEventListener("click", () => {
        const target = row.getAttribute("data-bs-target");
        if (target) {
          const collapseEl = document.querySelector(target);
          if (collapseEl) {
            const bsCollapse = new bootstrap.Collapse(collapseEl, { toggle: true });
          }
        }
      });
    });
  });

  // Dashboard urgency color function
  function getColor(diffMinutes) {
    if (diffMinutes <= 5) return "red";
    if (diffMinutes <= 20) return "orange";
    if (diffMinutes <= 60) return "green";
    return "blue";
  }
</script>
</body>
</html>
